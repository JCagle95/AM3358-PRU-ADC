.origin 0
.entrypoint START

.struct dataLoader
	.u32	RunFlag
	.u32	Data
.ends

#define	PRU_DATA0_BASE		0x00000000
#define PRU0_ARM_INTERRUPT	0x13

#define PRU_RAM_ADDRESS		R16
#define DATA				R17
#define DATA_ADDRESS		R18

START:
	MOV		PRU_RAM_ADDRESS, PRU_DATA0_BASE
	ADD		DATA_ADDRESS, PRU_RAM_ADDRESS, OFFSET(dataLoader.Data)
	LDI		DATA, 100
	SBBO	DATA, DATA_ADDRESS, 4 , 4

MAIN:
	SBBO	R31, DATA_ADDRESS, 0, 4
	SBBO	DATA, DATA_ADDRESS, 4, 4

DELAY:
	SET		R30, 0
	LDI		R0, 20000

DELAY_LOOP:
	SUB		R0, R0, 1
	QBLT	DELAY_LOOP, R0, 0
	
DELAY2:
	CLR		R30, 0
	LDI		R0, 20000

DELAY_LOOP2:
	SUB		R0, R0, 1
	QBLT	DELAY_LOOP2, R0, 0

	LBBO 	R0, PRU_RAM_ADDRESS, OFFSET(dataLoader.RunFlag), 4
	QBEQ 	EXIT, r0, 0
	JMP		MAIN

EXIT:
	MOV		R31.b0, PRU0_ARM_INTERRUPT + 16

HALT
